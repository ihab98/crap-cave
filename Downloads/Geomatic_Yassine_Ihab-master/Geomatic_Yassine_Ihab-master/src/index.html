<!DOCTYPE html>
<html>
  <head>
    
    <title>Mapersive</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../node_modules/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin=""/>
    
    
    <link rel="stylesheet" href="index.css">

    <style>#mapid { height: 550px;
                    width: 1000.828px;
                   
    
  
                    }
    
    </style>
  
  </head>

  <body class="background">

    <nav class="navbar navbar-custom   navbar-expand">
      <a class="navbar-brand" href="#"> <span class="fa fa-buysellads mr-2 purple"></span>     MAPERSIVE</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#" ><span class="fa fa-map mr-2 purple"></span>   MAP <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><span class="fa fa-sliders mr-2 purple"></span>   SETTINGS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="aboutus.html"><span class="fa fa-black-tie mr-2 purple"></span>   ABOUT US</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="Contact.html" onclick=""><span class="fa fa-address-card-o mr-2 purple"></span>  CONTACT</a>
          </li>
        </ul>
      </div>

      
    </nav>
    
    <div class="container-fluid mr-0 ml-0 mt-5 purple_border pt-3 pb-3 justify-content-center">

      <div class="row">
        <div class="col-3 ml-0">
            <div class="row m-0">
                <div class="col-12 pl-0 ">
                    <!-- Search form -->
                    <div class="form-group has-search">
                      <span class="fa fa-search form-control-feedback"></span>
                      <input type="text" class="form-control search w-75" >
                    </div>
                   
                    
                  </div>
            </div>
            <div class="row  mar-0">
              <div class="col-12 pl-0 mt-auto ">
                <div class="list-group w-75">
                  <a href="#" class="list-group-item list-group-item-action active">
                    <span class="fa fa-map-marker mr-2 purple" ></span>  Fort Lauderdale, FL
                  </a>
                  <a href="ny.html" class="list-group-item list-group-item-action" > <span class="fa fa-map-marker mr-2 purple"></span>   New York, NY</a>
                  <a href="chicago.html" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Chicago, IL</a>
                  <a href="miami.html" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Miami, FL</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Las Vegas, NV</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Waco, TX</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Laramie, WY</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Clearmont, CA</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Los Angeles, CA</a>
                  <a href="#" class="list-group-item list-group-item-action"><span class="fa fa-map-marker mr-2 purple"></span>   Boston, MA</a>
                  
                  
                 
                </div>
              </div>
        </div>
        <div class="col-7">
     
        </div>
      </div>
      <div class="col-9">
        <div class="row">
        <div id="pano" class="panel" style="width:1300px; height:600px; border-color: ;"></div> 
      </div>
        <div class="row justify-content-center">
          <div class="col-4 pt-2">
            <button type="button" class="btnDistance " data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="compute_first_angle();"><span class="fa fa-map-pin mr-2 purple"></span> Select First Perspective</button>
                   

                    <div class="collapse" id="collapseExample">
                      <div class="card card-body mt-2" id="heading1">
                        
                      </div>
                    </div>
          </div>
          <div class="col-4 pt-2">
            <button type="button" class="btnDistance" data-toggle="collapse" data-target="#collapseExample2" aria-expanded="false" aria-controls="collapseExample2" onclick="compute_second_angle();"><span class="fa fa-map-pin mr-2 purple"></span> Select Second Perspective</button>
                    

                    <div class="collapse" id="collapseExample2" >
                      <div class="card card-body mt-2" id="heading2">
                        
                      </div>
                    </div>
            
          </div>
          <div class="col-4 pt-2 pl-4">

            <button type="button" class="btnDistance " data-toggle="collapse" data-target="#collapseExample3" aria-expanded="false" aria-controls="collapseExample3" onclick="compute_distances();"><span class="	fa fa-arrows-h mr-2 purple"></span> Measure Distance</button>
              
              <div class="collapse" id="collapseExample3" >
                <div class="card card-body mt-2" id="distances">
                  
                </div>
              </div>
            
          </div>
        </div>
      </div>
    </div>

    <script src="../node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script src="../node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>
    <script src="annotate.js"></script>
    <script src="tour.js"></script>
    <script src="js/scripts.js"></script>
    <script src="krpano.js"></script>
    

    <script>

     var krpano = null;
     var heading1 = null;
     var heading2= null;
     var hotspot = null;
     const interval_dist = 7.0;

     embedpano({swf:"tour.swf", id : "krpanoSWFObject", xml:"tour.xml", target:"pano", consolelog : true, html5:"auto",
     mobilescale:1.0, passQueryParameters:true, passQueryParameters : true, onready : krpano_onready_callback});

     function krpano_onready_callback(krpano_interface)
      {
        krpano = krpano_interface;
      }

      function add_hotspot()
      {
        if (krpano)
        {
          krpano.call("removehotspot('temp_hs')");

          var h = krpano.get("view.hlookat");
          var v = krpano.get("view.vlookat");
          var hs_name = "temp_hs";

          krpano.call("addhotspot(" + hs_name + ")");
          krpano.set("hotspot["+hs_name+"].url", "tracked.png");
          krpano.set("hotspot["+hs_name+"].ath", h);
          krpano.set("hotspot["+hs_name+"].atv", v);
          krpano.set("hotspot["+hs_name+"].distorted", true);
          krpano.set("hotspot["+hs_name+"].alpha", 0.6);

          document.getElementById("heading1").innerHTML = 'First Perspective Selected Successfully (Heading 1: ' + heading1 + '°)';
          
        }
      }

     function compute_first_angle()
      {

          heading1 = krpano.get("data[first_angle].angle");
          add_hotspot();
          
      }

      function compute_second_angle()
      {
        if (heading1 != null){
          heading2 = -(krpano.get("view.hlookat") - 90.0);
          hotspot = -(krpano.get("data[last_clicked_hotspot].data") - 90.0);

          add_hotspot();
          document.getElementById("heading2").innerHTML = 'Second Perspective Selected Successfully (Heading 2: ' + heading2 + '°)' + hotspot;
          
          if ( krpano.get("device.html5") )
          {
            // for HTML5 it's possible to assign JS functions directly to krpano events
            krpano.set("hotspot["+hs_name+"].onclick", function(hs)
            {

            
            }.bind(null, hs_name));
          }
        }else{
          alert('No object selected for tracking!');
        }
      }
      function compute_distances()
      {
        var alpha = Math.abs(heading1) - Math.abs(hotspot);
        var a = 180.0 - Math.abs(hotspot);
        var beta = 360.0 - Math.abs(heading2) - Math.abs(a);
        var delta = 180.0 - Math.abs(alpha) - Math.abs(beta);
        var s1 = Math.abs(Math.sin(beta) * (interval_dist/Math.sin(delta)));
        var s2 = Math.abs(Math.sin(alpha) * (interval_dist/Math.sin(delta)));
        var corlat = krpano.get("data[current_coordinates].lat");
        var corlng = krpano.get("data[current_coordinates].lng");

        document.getElementById("distances").innerHTML = 'Distance from first camera to object (' + s1 + ' meters) <br>' + '------------------------- <br>'+' Distance from second camera to object (' + s2 + ' meters)' + '/lat and lng:' + corlat + ' ' + corlng;

      }

      function test()
      {
        var corax = actions.get(data[last_coordinates].lat);
        var coray = actions.get(data[last_coordinates].lng);

        var corbx = actions.get(data[current_coordinates].lat);
        var corby = actions.get(data[current_coordinates].lng);

        var alpha = actions.get(data[first_angle].angle);
        var beta = actions.get(data[second_angle].angle);

        var ya = Math.tan(alpha);
        var yb = Math.tan(beta);

        var xa = 1;
        var xb = 1;

        if(alpha>90 && alpha<270){
          xa = -xa;
          ya = -ya;
        }

        if(beta>90 && beta<270){
          xb = -xb;
          yb= -yb;
        }

        var pax = corax + xa;
        var pay = coray + ya;

        var pbx = corbx + xb;
        var pby = corby + yb;

        var intercept_a = (pax*coray - corax*pay)/(pax - corax);
        var intercept_b = (pbx*corby - corbx*pby)/(pbx - corbx);

        var intersect_x = (intercept_b - intercept_a)/(ya - yb);
        var intersect_y = (ya*(intercept_b - intercept_a)/(ya - yb)) + intercept_a;

      }

    </script>

    <script>
              var mymap = L.map('mapid').setView([33.5731, -7.5898], 13);
                      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(mymap);

         
              const myCustomColour = '#BB86FC'

              const markerHtmlStyles = `
                background-color: ${myCustomColour};
                width: 3rem;
                height: 3rem;
                display: block;
                left: -1.5rem;
                top: -1.5rem;
                position: relative;
                border-radius: 3rem 3rem 0;
                transform: rotate(45deg);
                border: 1px solid #FFFFFF`

              const icon = L.divIcon({
                className: "my-custom-pin",
                iconAnchor: [0, 24],
                labelAnchor: [-6, 0],
                popupAnchor: [0, -36],
                html: `<span style="${markerHtmlStyles}" />`
              })
              
              const purple_marker = L.marker([33.5731, -7.5898],{icon: icon});
              purple_marker.addTo(mymap);

              
              mymap.panTo(new L.LatLng(33.5731, -7.5898));

                                          

                            function onClick() { document.getElementById('mapid').style.height = "200px";
                                                 document.getElementById('mapid').style.width="200px";
                                                 mymap.panTo(new L.LatLng(33.5731, -7.5898));
                                                 mymap.invalidateSize()
                                                 
                                                 

                                    
                                                 

                            }
                            function onClick2() { document.getElementById('mapid').style.height = "550px";
                                                 document.getElementById('mapid').style.width="766.828px";
                                                 mymap.panTo(new L.LatLng(33.5731, -7.5898));
                                                 mymap.invalidateSize()
                                                 
                                                 

                                    
                                                 

                            }
              purple_marker.on('click', onClick);
              mymap.on('click', onClick2)


                          


    
    </script>
    

  </body>
</html>
